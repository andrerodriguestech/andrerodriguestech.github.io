"use strict";function urlB64ToUint8Array(e){for(var n=(e+"=".repeat((4-e.length%4)%4)).replace(/\-/g,"+").replace(/_/g,"/"),i=window.atob(n),s=new Uint8Array(i.length),t=0;t<i.length;++t)s[t]=i.charCodeAt(t);return s}function initialiseUI(){pushButton.addEventListener("click",function(){pushButton.disabled=!0,isSubscribed?unsubscribeUser():subscribeUser()}),swRegistration.pushManager.getSubscription().then(function(e){isSubscribed=!(null===e),updateSubscriptionOnServer(e),isSubscribed?console.log("User IS subscribed."):console.log("User is NOT subscribed."),updateBtn()})}function updateBtn(){if("denied"===Notification.permission)return pushButton.textContent="Notificações bloqueadas.",pushButton.disabled=!0,void updateSubscriptionOnServer(null);pushButton.textContent=isSubscribed?"Desabilite o Envio de Mensagens":"Habilite o Envio de Mensagens",pushButton.disabled=!1}function subscribeUser(){var e=urlB64ToUint8Array(applicationServerPublicKey);swRegistration.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:e}).then(function(e){console.log("User is subscribed:",e),updateSubscriptionOnServer(e),isSubscribed=!0,updateBtn()}).catch(function(e){console.log("Failed to subscribe the user: ",e),updateBtn()})}function updateSubscriptionOnServer(e){var n=document.querySelector(".js-subscription-json");n.textContent=e?JSON.stringify(e):""}function unsubscribeUser(){swRegistration.pushManager.getSubscription().then(function(e){if(e)return e.unsubscribe()}).catch(function(e){console.log("Error unsubscribing",e)}).then(function(){updateSubscriptionOnServer(null),console.log("User is unsubscribed."),isSubscribed=!1,updateBtn()})}var applicationServerPublicKey="BOKxs6WUroYgU_akMSztq1RG_c3TmqLK1J8yOtfIfcwzSiK3JLyLF-svI9jsOtR-v_7kF048U5uY\ntDxH3mCwbQQ",pushButton=document.querySelector(".js-push-btn"),isSubscribed=!1,swRegistration=null;"serviceWorker"in navigator&&"PushManager"in window?(console.log("Service Worker and Push is supported"),navigator.serviceWorker.register("sw.js").then(function(e){console.log("Service Worker is registered",e),swRegistration=e,initialiseUI()}).catch(function(e){console.error("Service Worker Error",e)})):(console.warn("Push messaging is not supported"),pushButton.textContent="Notificações não são suportadas");